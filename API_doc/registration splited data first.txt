@startuml

start
skinparam activityBackgroundColor #white

partition #84add6 "registration" {

:#b2cce5:form data for registration;
:#b2cce5:call API [/registration];
if (email exists ?) then(True)
	:set variable ifemailexists=true;
	:set variable ifemailverified according to whether participant is verified/unverified;
	if (ifemailverified?) then (True)
		:return {‘result’:‘Wrong’, ‘ifemailexists’=true, ‘ifemailexists_msg’};
		:#b2cce5:’participant already exists’;
		stop
	else (False)
		:internal CALL API to send e-mail for e-mail verification;
		:return {‘result’:‘OK’,’ifemailexists’=true,’ifemailexists_msg’,
		’ifemailverified’=false,’ifemailverified_msg’};
		:#b2cce5: ‘Participant already exists. E-mail not verified. E-mail verification sent. Close this window and check your e-mail within the next few minutes’;	
	stop
	endif
endif
:set variable ifemailverified = ifregistrationfromemail;
if (ifemailverified) then (True)
	:save data for new verified participant 
	(with default profilepic_url);
else (False)
	:save data for new unverified participant 
	(with default profilepic_url);
endif
if (ifemailverified) then (True)
	:login user;
else (False)
	:send e-mail for e-mail verification;	
endif
if (host_email?) then (exists)
	:set variable ifhost=True;
	:check host_email;
	:CALL -> current_participant (verified/unverified) follows host;
else
:set variable ifhost=False;
endif

:return {‘result’=‘OK’, ‘ifemailverified’, ‘ifemailverified_msg’, ‘ifhost’, ‘ifhost_msg’};

}

:#b2cce5:Frontend receives response;

partition #84add6 "complete registration with picture » {

if (is there a profilepic?) then (True)
	:#b2cce5: call API[/registration_uploadprofilepic, with (email,profilepic_body)];
	:check email and photo  exists;
	:set ifprofilepic=True;
	:compose profilepicURL;
	:upload profilepic;
	:set profilepicURL for participant;
	:return {"result": "OK","ifprofilepic": True,"ifprofilepic_msg":};
endif

}

:#b2cce5: CASES, /registration_basicdata and /registration_uploadprofilepic

x2 cases : ifemailverified true/false —> (true) redirect to newsfeed  / (false) MSG and user closes window.
x2 cases : ifprofilepic true/false —> possible MSG
x2 cases : ifhost true/false  ->  possible MSG
————
= 8 cases;

stop

@enduml

